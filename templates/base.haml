- load gears
!!! 5

%html{lang:"en"}
  %head
    %meta{charset:"utf-8"}
    %title SpkrBar.com - Helping good speakers become great speakers.
    %meta{name:"viewport", content:"width=device-width, initial-scale=1.0"}
    %meta{name:"description", content:""}
    %meta{name:"author", content:""}

    - css_asset_tag 'vendor/css/style.css'
    - css_asset_tag 'css/style.css'

    - js_asset_tag 'vendor/js/script.js'

    - block 'head'

    %link{rel:"apple-touch-icon-precomposed", sizes:"144x144", href:"../assets/ico/apple-touch-icon-144-precomposed.png"}
    %link{rel:"apple-touch-icon-precomposed", sizes:"114x114", href:"../assets/ico/apple-touch-icon-114-precomposed.png"}
    %link{rel:"apple-touch-icon-precomposed", sizes:"72x72", href:"../assets/ico/apple-touch-icon-72-precomposed.png"}
    %link{rel:"apple-touch-icon-precomposed", href:"../assets/ico/apple-touch-icon-57-precomposed.png"}
    %link{rel:"shortcut icon", href:"../assets/ico/favicon.png"}

  %body
    .container-fluid
      .masthead
        .row-fluid
          .span3
            %a{href:"/"}
              %img.logo{src:"{{STATIC_URL}}img/logo.png"}
          .span9
            .row-fluid
              .span12
                .search.pull-right
                  %form{method:"GET", action:"/search"}
                    %input.search-query{name:"query", type:"text", placeholder:"Search"}
                    %button.btn.btn-warning
                      %i.icon-search
            .row-fluid
              .span12
                %ul.nav.nav-pills.pull-right
                  %li
                    %a{href:"/talks"}
                      %i.icon-comments-alt
                      Talks
                  %li
                    %a{href:"/speakers"}
                      %i.icon-group
                      Speakers
                  %li
                    %a{href:"/events"}
                      %i.icon-calendar
                      Events

                  - if not user.is_anonymous
                    %li
                      %a.add-talk{href:"#add-talk-popup"}
                        %i.icon-plus
                        Add Talk

                  %li
                    %a{href:"/blog"}
                      %i.icon-file-text
                      Blog

                  - if user.is_anonymous
                    %li
                      %a{href:"/login"}
                        %i.icon-signin
                        Login
                    %li
                      %a{href:"/register"} Register
                  - else
                    %li.dropdown
                      %a.dropdown-toggle{data-toggle:"dropdown", href:"#"}
                        %i.icon-gear
                        My Account
                        %b.caret

                      - if user.notification_set.all
                        Notifications

                      %ul.dropdown-menu
                        %li
                          %a{href:"{{user.get_absolute_url}}"}
                            %i.icon-user
                            My Profile
                        %li
                          %a{href:"/profile/invite"}
                            %i.icon-mail-forward
                            Send Invites
                        - if user.is_superuser
                          %li
                            %a{href:"/admin"}
                              %i.icon-gears
                              Administration
                        %li
                          %a{href:"/logout"}
                            %i.icon-signout
                            Logout

      - block 'content-container'
        - block 'subnav-container' 
          .subnav
            .row-fluid
              .span6
                %h2
                  - block 'title'
                    Title Of Page
              .span6{style:"position: relative;"}
                .nav.btn-group.pull-right
                  - block 'subnav'
                #notifications

        - block 'callout'

        .content-container
          - block 'content'

      .clearfix

      .footer
        %p &copy; Agile Hog LLC. 2013

  - js_asset_tag 'js/script.js'

  %script{type:"text/javascript"}
    - if user.is_authenticated
      var userId = {{ user.id }};
      user = new SpkrBar.Models.User({'id': userId});
      user.fetch();
    - else
      user = null;

    var $buoop = {vs:{i:9,f:20,o:11,s:5,n:9}} 
    $buoop.ol = window.onload; 
    window.onload=function(){ 
      try {if ($buoop.ol) $buoop.ol();}catch (e) {console.log("Couldn't load browser update plugin");} 
      var e = document.createElement("script"); 
      e.setAttribute("type", "text/javascript"); 
      e.setAttribute("src", "http://browser-update.org/update.js"); 
      document.body.appendChild(e); 
    } 

  - block 'scripts'

  - include 'talks/_popup_talk_new_partial.haml'
  - include 'handlebars/notification.haml'
